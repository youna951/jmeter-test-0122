<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>QA ì‹¤ìŠµìš© ë¸”ë¡œê·¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            line-height: 1.6;
            background: #f4f7f6;
        }

        .container {
            max-width: 800px;
            margin: auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }

        /* ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .post-item {
            border-bottom: 1px solid #eee;
            padding: 15px 10px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .post-item:hover {
            background: #f0f7ff;
        }

        .post-title {
            font-weight: bold;
            color: #007bff;
            font-size: 1.1em;
        }

        /* ìƒì„¸í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        .detail-header {
            margin-bottom: 20px;
        }

        .btn-back {
            padding: 8px 15px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .post-content {
            font-size: 1.2em;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-left: 5px solid #007bff;
        }

        /* ëŒ“ê¸€ ìŠ¤íƒ€ì¼ */
        .comment-section {
            margin-top: 40px;
        }

        .comment-card {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .comment-author {
            font-weight: bold;
            color: #555;
        }

        .comment-email {
            color: #888;
            font-size: 0.8em;
        }
    </style>
</head>

<body>

    <div class="container">
        <div id="list-view">
            <h1>ğŸ“‹ ê²Œì‹œê¸€ ëª©ë¡</h1>
            <div id="post-list">ë¡œë”© ì¤‘...</div>
        </div>

        <div id="detail-view" style="display: none;">
            <button class="btn-back" onclick="showListView()">â† ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
            <div id="post-detail">
            </div>
            <div class="comment-section">
                <h3>ğŸ’¬ ëŒ“ê¸€</h3>
                <div id="comment-list">
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3333';

        // í™”ë©´ ì „í™˜ í•¨ìˆ˜: ëª©ë¡ ë³´ê¸°
        function showListView() {
            document.getElementById('list-view').style.display = 'block';
            document.getElementById('detail-view').style.display = 'none';
        }

        // í™”ë©´ ì „í™˜ í•¨ìˆ˜: ìƒì„¸ ë³´ê¸°
        function showDetailView() {
            document.getElementById('list-view').style.display = 'none';
            document.getElementById('detail-view').style.display = 'block';
        }

        // ì „ì²´ ê²Œì‹œê¸€ ê°€ì ¸ì˜¤ê¸°
        async function fetchPosts() {
            try {
                const response = await fetch(`${API_BASE}/posts`);
                const posts = await response.json();
                const listDiv = document.getElementById('post-list');
                listDiv.innerHTML = '';

                posts.forEach(post => {
                    const item = document.createElement('div');
                    item.className = 'post-item';
                    item.onclick = () => fetchPostDetail(post.id); // í´ë¦­ ì‹œ ìƒì„¸ ì¡°íšŒ í˜¸ì¶œ
                    item.innerHTML = `<div class="post-title">${post.id}. ${post.title}</div>`;
                    listDiv.appendChild(item);
                });
            } catch (e) {
                document.getElementById('post-list').innerHTML = '<b style="color:red">ì„œë²„ ì—°ê²° ì‹¤íŒ¨! í¬íŠ¸ 3333ì„ í™•ì¸í•˜ì„¸ìš”.</b>';
            }
        }

        // íŠ¹ì • ê²Œì‹œê¸€ ìƒì„¸ ë° ëŒ“ê¸€ ê°€ì ¸ì˜¤ê¸°
        // íŠ¹ì • ê²Œì‹œê¸€ ìƒì„¸ ë° ëŒ“ê¸€ ê°€ì ¸ì˜¤ê¸° (ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ ë°©ì‹)
        async function fetchPostDetail(postId) {
            showDetailView();
            const detailDiv = document.getElementById('post-detail');
            const commentDiv = document.getElementById('comment-list');

            detailDiv.innerHTML = 'ê²Œì‹œê¸€ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
            commentDiv.innerHTML = 'ëŒ“ê¸€ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';

            try {
                // 1. ê²Œì‹œê¸€ ë‹¨ê±´ ì¡°íšŒ (ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ ì‚¬ìš©: posts?id=postId)
                // ì£¼ì˜: ì´ ë°©ì‹ì€ í•­ìƒ ë°°ì—´ [ { ... } ] í˜•íƒœë¡œ ì‘ë‹µì´ ì˜´
                const postRes = await fetch(`${API_BASE}/posts?id=${postId}`);
                const postArray = await postRes.json();

                // ë°°ì—´ì˜ ì²« ë²ˆì§¸ ìš”ì†Œë¥¼ ê°€ì ¸ì˜´
                if (postArray.length > 0) {
                    const post = postArray[0];
                    detailDiv.innerHTML = `
                <h1>${post.title}</h1>
                <div class="post-content">${post.body}</div>
            `;
                } else {
                    detailDiv.innerHTML = '<b style="color:red">í•´ë‹¹ ê²Œì‹œê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</b>';
                    return;
                }

                // 2. í•´ë‹¹ ê²Œì‹œê¸€ì˜ ëŒ“ê¸€ ì¡°íšŒ (?postId=...)
                const commentRes = await fetch(`${API_BASE}/comments?postId=${postId}`);
                const comments = await commentRes.json();

                commentDiv.innerHTML = '';
                if (comments.length === 0) {
                    commentDiv.innerHTML = '<p>ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                } else {
                    comments.forEach(comment => {
                        const cCard = document.createElement('div');
                        cCard.className = 'comment-card';
                        cCard.innerHTML = `
                    <div class="comment-author">${comment.name}</div>
                    <div class="comment-email">${comment.email}</div>
                    <p>${comment.body}</p>
                `;
                        commentDiv.appendChild(cCard);
                    });
                }
            } catch (e) {
                console.error(e);
                detailDiv.innerHTML = '<b style="color:red">ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</b>';
            }
        }

        // ì´ˆê¸° ì‹¤í–‰
        fetchPosts();
    </script>

</body>

</html>